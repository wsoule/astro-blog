/** 
 * Simple Banner v0.5.9
 * @author Sandro Ducceschi
 * @url https://eatcodeplay.dev
 */
var R=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var G=(u,e)=>{for(var t in e)R(u,t,{get:e[t],enumerable:!0})},J=(u,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of X(e))!_.call(u,n)&&n!==t&&R(u,n,{get:()=>e[n],enumerable:!(i=K(e,n))||i.enumerable});return u};var Q=u=>J(R({},"__esModule",{value:!0}),u);var ne={};G(ne,{default:()=>F});module.exports=Q(ne);var k=require("obsidian");var y=require("obsidian");var x={desktop:{bannerEnabled:!0,height:240,viewOffset:0,noteOffset:-32,bannerRadius:[8,8,8,8],bannerPadding:8,bannerFade:!0,iconEnabled:!1,iconSize:96,iconRadius:8,iconBackground:!0,iconBorder:2,iconAlignment:["flex-start","flex-end"],iconOffset:[0,-24],datetimeEnabled:!1,datetimeOnPropOnly:!1,datetimeAlignment:["flex-end","flex-start"],datetimeOffset:[0,0],datetimeTimeFormat:"HH:mm",datetimeDateFormat:"dddd, MMMM Do YYYY",interop:{}},tablet:{bannerEnabled:!0,height:190,viewOffset:0,noteOffset:-32,bannerRadius:[8,8,8,8],bannerPadding:8,bannerFade:!0,iconEnabled:!1,iconSize:96,iconRadius:8,iconBackground:!0,iconBorder:2,iconAlignment:["flex-start","flex-end"],iconOffset:[0,-24],datetimeEnabled:!1,datetimeOnPropOnly:!1,datetimeAlignment:["flex-end","flex-start"],datetimeOffset:[0,0],datetimeTimeFormat:"HH:mm",datetimeDateFormat:"dddd, MMMM Do YYYY",interop:{}},phone:{bannerEnabled:!0,height:160,viewOffset:0,noteOffset:-32,bannerRadius:[8,8,8,8],bannerPadding:8,bannerFade:!0,iconEnabled:!1,iconSize:56,iconRadius:8,iconBackground:!0,iconBorder:2,iconAlignment:["flex-start","flex-end"],iconOffset:[0,-24],datetimeEnabled:!1,datetimeOnPropOnly:!1,datetimeAlignment:["flex-end","flex-start"],datetimeOffset:[0,0],datetimeTimeFormat:"HH:mm",datetimeDateFormat:"dddd, MMMM Do YYYY",interop:{}},properties:{autohide:!0,image:"banner",icon:"icon",datetime:"datetime"}},H="rotate-ccw",$="Restore default",T=class u extends y.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}static get currentDevice(){return y.Platform.isPhone?"phone":y.Platform.isTablet?"tablet":"desktop"}static prepare(e){let t=n=>n&&typeof n=="object"&&!Array.isArray(n),i={...x};for(let n in e)if(e.hasOwnProperty(n)){let a=e[n];t(a)&&i.hasOwnProperty(n)&&t(i[n])?i[n]={...i[n],...a}:i[n]=a}return i}display(){let{containerEl:e}=this;e.empty();let t=u.currentDevice,i=this.plugin.settings[t];this.createBannerSettings(),i.bannerEnabled&&(this.createFrontmatterSettings(),this.createIconSettings(),this.createDatetimeSettings())}createBannerSettings(){let e=u.currentDevice,t=this.plugin.settings[e],i=x[e];this.addToggle({title:"Show simple banner",description:`Enable or disable Simple Banner on your ${e} device.`,refreshOnUpdate:!0},t,"bannerEnabled"),t.bannerEnabled&&(this.addNumber({title:"Height",description:`Height of the Banner on your ${e} device (in pixels).`,placeholder:"Enter a number",resetValue:i.height},t,"height"),this.addNumber({title:"Padding",description:"Padding of the banner from the edges of the note in pixels.",placeholder:"Enter a number",resetValue:i.bannerPadding},t,"bannerPadding"),this.addNumber({title:"Note offset",description:"Move the position of the notes content in pixels.",placeholder:"Enter a number",resetValue:i.noteOffset},t,"noteOffset"),this.addNumber({title:"View offset",description:"Move the position of the view content in pixels.",placeholder:"Enter a number",resetValue:i.viewOffset},t,"viewOffset"),this.addNumber({title:"Border radius",description:"Size of the border radius in pixels.",placeholder:"8",isValueArray:!0,length:4,resetValue:i.bannerRadius,classes:["sbs-grid-radius"]},t,"bannerRadius"),this.addToggle({title:"Fade",description:"Fade the image out towards the content.",classes:["sbs-spacer"]},t,"bannerFade"))}createFrontmatterSettings(){let t=this.plugin.settings;this.addHeading("Frontmatter",["sbs-heading"]),this.addToggle({title:"Autohide frontmatter/properties",description:"Enable or disables the frontmatter/properties autohide feature."},t.properties,"autohide"),this.addText({title:"Banner property",description:"Name of the banner property this plugin will look for in the frontmatter.",placeholder:"Default: banner",resetValue:x.properties.image},t.properties,"image"),this.addText({title:"Icon property",description:"Name of the icon property this plugin will look for in the frontmatter.",placeholder:"Default: icon",resetValue:x.properties.icon},t.properties,"icon"),this.addText({title:"Datetime property",description:"Name of the datetime property this plugin will look for in the frontmatter.",placeholder:"Default: datetime",resetValue:x.properties.datetime,classes:["sbs-spacer"]},t.properties,"datetime")}createIconSettings(){let e=u.currentDevice,t=this.plugin.settings[e],i=x[e];this.addHeading("Icon",["sbs-heading"]),this.addToggle({title:"Show icon",description:"Enable or disable the icon.",refreshOnUpdate:!0},t,"iconEnabled"),t.iconEnabled&&(this.addNumber({title:"Icon size",description:"Size of the icon in pixels.",placeholder:"Enter a number",resetValue:i.iconSize},t,"iconSize"),this.addToggle({title:"Icon background",description:"Enable or disable the icon background."},t,"iconBackground"),this.addNumber({title:"Border size",description:"Size of the border in pixels.",placeholder:"Enter a number",resetValue:i.iconBorder},t,"iconBorder"),this.addNumber({title:"Border radius",description:"Size of the border radius in pixels.",placeholder:"Enter a number",resetValue:i.iconRadius},t,"iconRadius"),this.addDropdown({title:"Icon alignment - horizontal",description:"Horizontal alignment of the icon.",choices:[{label:"Left",value:"flex-start"},{label:"Middle",value:"center"},{label:"Right",value:"flex-end"}],resetValue:i.iconAlignment[0]},t,"iconAlignment",0),this.addDropdown({title:"Icon alignment - vertical",description:"Vertical alignment of the icon.",choices:[{label:"Top",value:"flex-start"},{label:"Middle",value:"center"},{label:"Bottom",value:"flex-end"}],resetValue:i.iconAlignment[1]},t,"iconAlignment",1),this.addNumber({title:"Icon offset",description:"Offset the X and Y position of the icon in pixels",placeholder:"0",isValueArray:!0,length:2,resetValue:i.iconOffset,classes:["sbs-grid-xy","sbs-spacer"]},t,"iconOffset"))}createDatetimeSettings(){let e=u.currentDevice,t=this.plugin.settings[e],i=x[e];this.addHeading("Datetime",["sbs-heading"]),this.addToggle({title:"Show datetime",description:"Enable or disable the display of a datetime.",refreshOnUpdate:!0},t,"datetimeEnabled"),t.datetimeEnabled&&(this.addToggle({title:"Only with property",description:"Show datetime only when a property is set in the note"},t,"datetimeOnPropOnly"),this.addText({title:"Time formatting",description:(0,y.sanitizeHTMLToDom)('Define how time should be displayed. Leave empty to disable.<br/>Obsidian uses moment.js for formatting. <a href="https://momentjs.com/docs/#/displaying/format/" target="_blank">Learn more</a>'),placeholder:"Default: HH:mm:ss",allowEmpty:!0,resetValue:i.datetimeTimeFormat},t,"datetimeTimeFormat"),this.addText({title:"Date formatting",description:(0,y.sanitizeHTMLToDom)('Define how the date should be displayed. Leave empty to disable.<br/>Obsidian uses moment.js for formatting. <a href="https://momentjs.com/docs/#/displaying/format/" target="_blank">Learn more</a>'),placeholder:"Default: dddd, MMMM Do YYYY",allowEmpty:!0,resetValue:i.datetimeDateFormat},t,"datetimeDateFormat"),this.addDropdown({title:"Datetime alignment - horizontal",description:"Horizontal alignment of the datetime.",choices:[{label:"Left",value:"flex-start"},{label:"Middle",value:"center"},{label:"Right",value:"flex-end"}],allowEmpty:!0,resetValue:i.datetimeAlignment[0]},t,"datetimeAlignment",0),this.addDropdown({title:"Datetime alignment - vertical",description:"Vertical alignment of the datetime.",choices:[{label:"Top",value:"flex-start"},{label:"Middle",value:"center"},{label:"Bottom",value:"flex-end"}],resetValue:i.datetimeAlignment[1]},t,"datetimeAlignment",1),this.addNumber({title:"Datetime offset",description:"Offset the X and Y position of the datetime in pixels",placeholder:"0",isValueArray:!0,length:2,resetValue:i.datetimeOffset,classes:["sbs-grid-xy","sbs-spacer"]},t,"datetimeOffset"))}addHeading(e,t){let i=new y.Setting(this.containerEl).setHeading().setName(e);this.setClasses(i,t)}addToggle(e,t,i){let n=new y.Setting(this.containerEl);e.title&&n.setName(e.title),e.description&&n.setDesc(e.description),this.setClasses(n,e.classes),n.addToggle(a=>a.setValue(t[i]).onChange(async s=>{t[i]=s,await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}))}addDropdown(e,t,i,n){let a=e.resetValue!==void 0,s=e.resetValue,o=new y.Setting(this.containerEl),r=n!==void 0;e.title&&o.setName(e.title),e.description&&o.setDesc(e.description),this.setClasses(o,e.classes),a&&o.addExtraButton(l=>l.setIcon(H).setTooltip($).onClick(async()=>{r?t[i][n]=s:t[i]=s,await this.plugin.saveSettings(),this.display()})),o.addDropdown(l=>(((e==null?void 0:e.choices)||[]).forEach(d=>{l.addOption(d.value,d.label)}),r?l.setValue(t[i][n]):l.setValue(t[i]),l.onChange(async d=>{r?t[i][n]=d:t[i]=d,await this.plugin.saveSettings()}),l))}addText(e,t,i){let n=e.resetValue!==void 0,a=e.resetValue,s=new y.Setting(this.containerEl);e.title&&s.setName(e.title),e.description&&s.setDesc(e.description),this.setClasses(s,e.classes),n&&s.addExtraButton(o=>o.setIcon(H).setTooltip($).onClick(async()=>{t[i]=a,await this.plugin.saveSettings(),this.display()})),s.addText(o=>(e.placeholder&&o.setPlaceholder(e.placeholder),o.setValue(t[i].toString()).onChange(async r=>{e.allowEmpty?t[i]=r:t[i]=r!==""?r:a||"",await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}),o))}addNumber(e,t,i){let n=e.float,a=e.resetValue!==void 0,s=e.resetValue,o=new y.Setting(this.containerEl);if(e.title&&o.setName(e.title),e.description&&o.setDesc(e.description),this.setClasses(o,e.classes),a&&o.addExtraButton(r=>r.setIcon(H).setTooltip($).onClick(async()=>{t[i]=e.isValueArray?[...s]:s,await this.plugin.saveSettings(),this.display()})),e.isValueArray&&e.length!==void 0){let r=e.placeholders!==void 0;for(let l=0;l<e.length;l++)o.addText(c=>(r&&(e!=null&&e.placeholders)?c.setPlaceholder(e.placeholders[l]||""):e.placeholder&&c.setPlaceholder(e.placeholder),c.setValue(t[i][l].toString()).onChange(async d=>{let h=n?parseFloat(d):parseInt(d,10);isNaN(h)&&a&&(h=s[l]||0),t[i][l]=h,await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}),c))}else o.addText(r=>(e.placeholder&&r.setPlaceholder(e.placeholder),r.setValue(t[i].toString()).onChange(async l=>{let c=n?parseFloat(l):parseInt(l,10);isNaN(c)&&a&&(c=s),t[i]=c,await this.plugin.saveSettings(),e.refreshOnUpdate&&this.display()}),r))}setClasses(e,t){t&&t.forEach(i=>e.setClass(i))}};var M=class{static async migrate(e,t){let i="desktop",n="tablet",a="phone",s={desktopHeight:{target:"desktop.height"},tabletHeight:{target:"tablet.height"},mobileHeight:{target:"phone.height"},offset:{target:"noteOffset",devices:[i,n,a]},fade:{target:"bannerFade",devices:[i,n,a]},radius:{target:"bannerRadius",devices:[i,n,a]},padding:{target:"bannerPadding",devices:[i,n,a]},propertyName:{target:"properties.image"}},o=!1,r={...e};for(let l in s)if(r.hasOwnProperty(l)&&r[l]!==void 0){o=!0;let c=s[l];c.devices?c.devices.forEach(d=>{let h=d+"."+c.target;this.setValueByPath(r,h,r[l])}):this.setValueByPath(r,c.target,r[l]),delete r[l]}return o&&await t.saveData(r),r}static setValueByPath(e,t,i){let n=t.split("."),a=e;for(let s=0;s<n.length-1;s++){let o=n[s];(!a[o]||typeof a[o]!="object")&&(a[o]={}),a=a[o]}a[n[n.length-1]]=i}};var O={},w=class{static get(e){return O[e]||null}static set(e,t){O[e]=t}static delete(e=null){e&&delete O[e]}static exists(e){return O[e]!==void 0}static getAll(){return O}static getIds(){return Object.keys(O)}};var j,v=class{static init(e){j=e}static calculateFontsize(e,t){let i=document.createElement("span");i.setAttribute("style","position: absolute; visibility: hidden; white-space: nowrap;"),i.style.padding="0",i.style.margin="0",i.style.left="-9999px",i.textContent=e.toUpperCase(),document.body.appendChild(i);let n=t,a=n-16,s=n;for(i.style.fontSize=s+"px";i.offsetWidth>a&&s>1;)s-=1,i.style.fontSize=s+"px";return document.body.removeChild(i),`${s}px`}static setCSSVariables(e,t=document.body){let i=t.style;Object.keys(e).forEach(n=>{i.setProperty(`--sb-${n}`,e[n])})}};var A=require("obsidian");var B,E={Wikilink:/^!?\[\[([^\]]+?)(\|([^\]]+?))?\]\]$/,Markdown:/^!?\[([^\]]*)\]\(([^)]+?)\)$/,MarkdownBare:/^!?<([^>]+)>$/,Weblink:/^https?:\/\//i},D=class{static init(e){B=e}static async link(e,t,i){let n=null,a=null,s,o=!1,r={x:0,y:0,repeatable:!1},l=e.match(E.Wikilink);l&&(n=l[1].trim(),a=l[3]?l[3].trim():null);let c=e.match(E.Markdown),d=e.match(E.MarkdownBare);if(c?(a=c[1].trim(),n=c[2].trim()):d&&(n=d[1].trim(),a=null),n||(n=e,a=null),s=E.Weblink.test(n),this.isObsidianUrl(n)){let f=n.replace("obsidian://open",""),g=new URLSearchParams(f).get("file");g&&(n=g,o=!0,s=!1,a=null)}n.startsWith("file:")&&(n=n.replace(/^file:\/{1,}/,A.Platform.resourcePathPrefix),s=!0);let h=n.indexOf("#");if((s||o)&&h!==-1&&(r=this.imageProperties(n.substring(h+1)),n=n.replace(/#.*/,"").trim()),a&&(r=this.imageProperties(a)),!s){let f=B.app.vault,m=null;if(t&&t.file&&(n.includes("../")||n.includes("./")||!n.startsWith("/")&&n.includes("/"))){let g=t.file.path,b=B.app.metadataCache.getFirstLinkpathDest(n,g);b&&(m=b)}if(!m){let g=f.getFiles().filter(b=>b.path===n||b.name===n);m=g.find(b=>b.path===n)||null,m||(m=g.find(b=>b.name===n)||null)}if(m&&(n=f.getResourcePath(m)),o&&m&&t){let g=B.app.workspace.getActiveFile();g&&B.app.fileManager.processFrontMatter(g,b=>{let C=i||B.settingProperties.image;b[C]=`[[${m==null?void 0:m.path}]]`})}}let p=null;try{let f=new URL(n);if(f){let m=f.pathname.split(".").pop(),g=["jpg","jpeg","png","gif","svg","webp"],b=["mp4","webm","ogg","ogv","mov","avi","wmv","mpg","mpeg","3gp"];m&&g.includes(m)?p="image":m&&b.includes(m)&&(p="video")}if(!p){let m=await(0,A.requestUrl)({url:n,method:"HEAD"}),g=(m==null?void 0:m.headers["content-type"])||null;g&&(g.includes("image")?p="image":g.includes("video")&&(p="video"))}}catch(f){console.log(f)}return{url:`"${n.trim().replace(/(["\\])/g,"\\$1")}"`,external:s,type:p,...r}}static imageProperties(e){let t,i=0,n=0;t=e.toLowerCase().includes("repeat");let o=e.split(/x|,/).filter(r=>!isNaN(parseInt(r.trim(),10)));return o.length===2?(i=parseInt(o[0].trim(),10),n=parseInt(o[1].trim(),10)):o.length===1&&(n=parseInt(o[0].trim(),10)),{x:i,y:n,repeatable:t}}static async icon(e,t){let i=e||"",n={value:null,type:"text"};if(E.Wikilink.test(i)?n.type="link":E.Markdown.test(i)||E.MarkdownBare.test(i)?n.type="link":E.Weblink.test(e)?n.type="link":this.isObsidianUrl(e)&&(n.type="link"),n.type==="link"){let a=await this.link(i,t,B.settingProperties.icon);n.value=a.url}else n.value=i;return n}static async isImagePropertiesUpdate(e,t,i){if(!e||!t)return!1;let n=await this.link(e,i),a=await this.link(t,i);return n.url===a.url}static isObsidianUrl(e){return e.startsWith("obsidian://open")}};var S=class{constructor(e,t){this.plugin=e,this.settings=t}};var W=".simple-banner",I=class extends S{constructor(e,t){super(e,t)}destroy(){}update(e,t,i){let{isImageChange:n,isImagePropsUpdate:a}=e,s=[];return i.forEach(o=>{var l;let r=o.querySelector(W)||document.createElement("div");if(r.classList.add("simple-banner"),s.push(r),n||a){n&&(r.classList.remove("static"),(l=r.firstChild)==null||l.remove());let c={"img-x":`${t.x}px`,"img-y":`${t.y}px`,size:t.repeatable?"auto":"revert-layer",repeat:t.repeatable?"repeat":"revert-layer",url:"none"};if(t.type==="video"){let d=document.createElement("video");d.controls=!1,d.autoplay=!0,d.muted=!0,d.loop=!0,d.src=t.url,r.appendChild(d),c.url="none"}else c.url=`url(${t.url})`;v.setCSSVariables(c,o)}}),s}inject(e,t){t.forEach((i,n)=>{let a=e[n];i.prepend(a),a.onanimationend=()=>{document.querySelectorAll(W).forEach(o=>o.classList.add("static"))}})}replace(e){e.forEach(t=>{t.classList.add("static")})}};var Y=require("obsidian");var P=class extends S{constructor(e,t){super(e,t)}destroy(){}async update(e,t){let{iconEnabled:i,iconSize:n}=this.settings,a=null;for(let s=0,o=t.length;s<o;s+=1){let r=t[s],{icon:l,view:c}=e,d=r.querySelector(".icon")||null,h=d!==null;if(h&&(d==null||d.classList.add("static")),i&&l){if(!h){d=document.createElement("div"),d.classList.add("icon"),Y.Platform.isWin&&d.classList.add("is-windows");let b=document.createElement("div");d.appendChild(b),r.prepend(d)}let p=d==null?void 0:d.querySelector("div"),{value:f,type:m}=await D.icon(l,c);f=(f==null?void 0:f.replace(/([#.:[\\]"])/g,"\\$1"))||"",p.dataset.type=m;let g={};g["icon-value"]=m==="link"?`url(${f})`:`"${f}"`,m==="text"&&(a=a||v.calculateFontsize(f,n),g["icon-fontsize"]=a),v.setCSSVariables(g,p)}else h&&(e.icon=null,d==null||d.remove())}}};var U=require("obsidian");var z=".simple-banner > div.date-time",L=class extends S{constructor(e,t){super(e,t),this.processTime()}destroy(){window.clearInterval(this.intervalId)}update(e,t){let{datetimeEnabled:i,datetimeOnPropOnly:n}=this.settings,{datetime:a}=e;i?t.forEach(s=>{let o=s.querySelector(".date-time")||null,r=o!==null;if(r&&(o==null||o.classList.add("static")),i&&!n||i&&n&&a){if(!r){o=document.createElement("div"),o.classList.add("date-time");let c=document.createElement("time");o.appendChild(c),s.prepend(o)}let l=o==null?void 0:o.querySelector("time");l.classList.remove("static"),a?(l.classList.add("static"),this.updateTime([l],a,!0)):n||this.updateTime([l])}else r&&(o==null||o.remove())}):document.querySelectorAll(z).forEach(o=>{o.remove()})}check(){let e=this.intervalId,{datetimeEnabled:t,datetimeOnPropOnly:i}=this.settings;if(t&&!i){let n=document.querySelectorAll(z).length;n===0&&e!==void 0?(window.clearInterval(this.intervalId),this.intervalId=void 0):n>0&&e===void 0&&(this.intervalId=window.setInterval(()=>this.processTime(),1e3))}}processTime(){let{datetimeEnabled:e,datetimeOnPropOnly:t,datetimeTimeFormat:i,datetimeDateFormat:n}=this.settings,a=i!=="",s=n!=="";if(e&&!t){let o=(0,U.moment)();this.time=a?o.format(i):"",this.date=s?o.format(n):"",this.iso=o.toISOString(),this.updateTime()}}updateTime(e,t,i){let{datetimeEnabled:n,datetimeTimeFormat:a,datetimeDateFormat:s}=this.settings,o=a!=="",r=s!=="";if(n){let{time:l,date:c,iso:d}=this;if(t){let p=(0,U.moment)(t);l=o?p.format(a):"",c=r?p.format(s):"",t.includes("T")||(l=""),d=p.toISOString()}let h=e||document.querySelectorAll(`${z} > time`);h.length>0&&h.forEach(p=>{var m;if(((m=p.children)==null?void 0:m.length)===0)p.createEl("span",{text:l}),p.createEl("span",{text:c});else if(!p.classList.contains("static")||i){let g=p.querySelectorAll("span"),b=[l,c];g.forEach((C,q)=>{C.textContent=b[q]||""})}p.setAttribute("datetime",d||"")})}}};var V=class extends S{constructor(e,t){super(e,t)}destroy(){}update(e,t){}check(){}};var F=class extends k.Plugin{async onload(){let e=this.app,t=e.workspace;D.init(this),v.init(this),await this.loadSettings(),this.addSettingTab(new T(e,this)),this.featBanner=new I(this,this.deviceSettings),this.featIcon=new P(this,this.deviceSettings),this.featDatetime=new L(this,this.deviceSettings),this.featPluginInterop=new V(this,this.deviceSettings),t.onLayoutReady(()=>{this.registerEvent(t.on("window-open",this.handleWindowOpen.bind(this))),this.registerEvent(t.on("layout-change",this.handleLayoutChange.bind(this))),this.registerEvent(t.on("file-open",this.handleFileOpen.bind(this))),this.registerEvent(e.metadataCache.on("changed",this.handleMetaChange.bind(this))),this.applySettings()})}onunload(){let{featBanner:e,featIcon:t,featDatetime:i,featPluginInterop:n}=this;e.destroy(),t.destroy(),i.destroy(),n.destroy()}processAll(){this.app.workspace.iterateRootLeaves(e=>{let t=e.view;if(t)if(this.deviceSettings.bannerEnabled){let i=(t==null?void 0:t.file)||null;this.process(i,t)}else this.remove()})}async process(e,t){let i=await this.compute(e,t);if(i){if(!i.image){this.remove(i);return}i.icon||(i.needsUpdate=!0),this.deviceSettings.bannerEnabled&&this.render(i)}}async compute(e,t){let i=t||this.getActiveView();if(e&&i instanceof k.MarkdownView){let n=this.createDefaultBannerData(),a=w.get(i==null?void 0:i.leaf.id)||n,s=this.createDefaultBannerData(i,a.viewMode),o=this.app.metadataCache.getFileCache(e),r=o==null?void 0:o.frontmatter;if(r){let l=this.settingProperties,c=l.image,d=l.icon,h=l.datetime;r[c]&&(s.image=r[c],s.filepath=e.path,a.filepath!==s.filepath?(s.needsUpdate=!0,s.isImageChange=!0):a.image!==s.image&&(s.needsUpdate=!0,s.isImageChange=!0,await D.isImagePropertiesUpdate(a.image,s.image,i)&&(s.isImagePropsUpdate=!0,s.isImageChange=!1))),this.deviceSettings.iconEnabled&&(r[d]?(s.icon=r[d],s.filepath=e.path,a.icon!==s.icon&&(s.needsUpdate=!0)):a.icon&&(s.icon=null,s.needsUpdate=!0)),this.deviceSettings.datetimeEnabled&&(r[h]?(s.datetime=r[h],s.filepath=e.path,a.datetime!==s.datetime&&(s.needsUpdate=!0)):a.datetime&&(s.datetime=null,s.needsUpdate=!0))}return s}return null}async render(e){let{image:t,viewMode:i,lastViewMode:n,view:a,needsUpdate:s,isImageChange:o}=e,r=a==null?void 0:a.containerEl;if(r&&(n!==i||s)){let l=r.querySelectorAll(".cm-scroller, .markdown-reading-view > .markdown-preview-view"),c=await D.link(t||"",a),{featBanner:d,featIcon:h,featDatetime:p,featPluginInterop:f}=this,m=d.update(e,c,l);h.update(e,m),p.update(e,m),f.update(e,m),o?d.inject(m,l):d.replace(m),p.check(),e.lastViewMode=i,r.dataset.sb="",w.set(a==null?void 0:a.leaf.id,e)}}remove(e){let t=(e==null?void 0:e.view)||this.getActiveView();if(t instanceof k.MarkdownView){let i=t==null?void 0:t.containerEl;i&&(i.querySelectorAll(".simple-banner").forEach(a=>{a.remove()}),this.updateMetaDOM(!0),w.delete(t==null?void 0:t.leaf.id),delete i.dataset.sb)}}async loadSettings(){let e=await this.loadData(),t=T.prepare(e);this.settings=await M.migrate(t,this),this.deviceSettings=this.settings[T.currentDevice],this.settingProperties=this.settings.properties}async saveSettings(){await this.saveData(this.settings),this.applySettings()}applySettings(){let e=this.deviceSettings,t=e.height,i=e.noteOffset,n=e.viewOffset,a=e.bannerRadius,s=e.bannerPadding,o=e.bannerFade,r={};if(r.height=`${t}px`,r["note-offset"]=`${i}px`,r["view-offset"]=`${n}px`,r.radius=`${a[0]}px ${a[1]}px ${a[2]}px ${a[3]}px`,r.padding=`${s}px`,r.mask=o?"revert-layer":"initial",r["mask-webkit"]=o?"revert-layer":"initial",e.iconEnabled){let l=e.iconSize,c=e.iconRadius,d=e.iconBackground,h=e.iconBorder,p=e.iconAlignment,f=e.iconOffset;r["icon-size-w"]=`${l}px`,r["icon-size-h"]=`${l}px`,r["icon-radius"]=`${c}px`,r["icon-align-h"]=p[0],r["icon-align-v"]=p[1],r["icon-offset-x"]=`${f[0]}px`,r["icon-offset-y"]=`${f[1]}px`,r["icon-border"]=`${h}px`,r["icon-background"]=d?"revert-layer":"transparent"}if(e.datetimeEnabled){let l=e.datetimeAlignment,c=e.datetimeOffset;r["dt-align-h"]=l[0],r["dt-align-v"]=l[1],r["dt-offset-x"]=`${c[0]}px`,r["dt-offset-y"]=`${c[1]}px`}v.setCSSVariables(r),this.settings.properties.autohide?document.body.classList.add("sb-autohide"):document.body.classList.remove("sb-autohide"),this.processAll()}handleWindowOpen(){let e=setInterval(()=>{this.getActiveView()&&(clearInterval(e),this.handleLayoutChange())},100)}handleLayoutChange(){let e=this.getActiveView();e?(this.updateMetaDOM(),w.exists(e==null?void 0:e.leaf.id)||this.process(e.file,e)):w.delete(this.getMostRecentLeafId()),this.featDatetime.check()}handleFileOpen(e){let t=this.getActiveView();t instanceof k.MarkdownView&&(this.process(e,t),this.updateMetaDOM())}handleMetaChange(e){this.app.workspace.iterateRootLeaves(t=>{let i=t.view;i.file===e&&this.process(e,i)})}updateMetaDOM(e=!1){if(this.settings.properties.autohide){let t=document.querySelectorAll(".workspace-leaf-content[data-sb] .inline-title"),i=document.querySelectorAll(".workspace-leaf-content[data-sb] .metadata-container");t.length>0&&i.length>0&&t.forEach((n,a)=>{i[a]&&(e?n.after(i[a]):n.before(i[a]))})}}getActiveView(){return this.app.workspace.getActiveViewOfType(k.MarkdownView)||null}getMostRecentLeafId(){return this.app.workspace.getMostRecentLeaf().id}createDefaultBannerData(e,t){let i=null;return e&&(i=(e.getMode()||null)==="preview"?"preview":"source"),{filepath:null,image:null,icon:null,datetime:null,viewMode:i,lastViewMode:t||null,isImagePropsUpdate:!1,isImageChange:!1,needsUpdate:!1,view:e}}};

/* nosourcemap */