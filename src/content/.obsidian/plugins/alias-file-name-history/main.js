/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var E=(r,n)=>{for(var e in n)y(r,e,{get:n[e],enumerable:!0})},N=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of I(n))!R.call(r,s)&&s!==e&&y(r,s,{get:()=>n[s],enumerable:!(t=P(n,s))||t.enumerable});return r};var L=r=>N(y({},"__esModule",{value:!0}),r);var k={};E(k,{default:()=>v});module.exports=L(k);var F=require("obsidian");var A={ignoreRegexes:["^_","^Untitled$","^Untitled \\d+$"],timeoutSeconds:5,caseSensitive:!1,autoCreateFrontmatter:!0,includeFolders:[],excludeFolders:[],fileExtensions:["md"],trackFolderRenames:""};var g=require("obsidian"),x=class extends g.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new g.Setting(e).setName("Ignore regex patterns").setDesc("Comma-separated regex patterns for file names or immediate parent folder names to ignore (e.g., ^_ for underscore prefixes, ^Untitled$ for Untitled). Leave empty to disable.").addText(t=>t.setPlaceholder("^_,^Untitled$,^Untitled \\d+$").setValue(this.plugin.settings.ignoreRegexes.join(",")).onChange(async s=>{this.plugin.settings.ignoreRegexes=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()})),new g.Setting(e).setName("Timeout seconds").setDesc("Time in seconds the name must be stable before adding aliases.").addSlider(t=>t.setLimits(1,20,1).setValue(this.plugin.settings.timeoutSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.timeoutSeconds=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Case sensitive uniqueness").setDesc('If enabled, treat "Note" and "note" as different aliases.').addToggle(t=>t.setValue(this.plugin.settings.caseSensitive).onChange(async s=>{this.plugin.settings.caseSensitive=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Auto-create properties").setDesc("Automatically create properties with aliases if missing.").addToggle(t=>t.setValue(this.plugin.settings.autoCreateFrontmatter).onChange(async s=>{this.plugin.settings.autoCreateFrontmatter=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("Track folder renames for specific file name").setDesc("If a markdown file matches this file name, store old immediate parent folder names as aliases when parent folders are renamed.").addText(t=>t.setPlaceholder("index").setValue(this.plugin.settings.trackFolderRenames).onChange(async s=>{this.plugin.settings.trackFolderRenames=s,await this.plugin.saveSettings()})),new g.Setting(e).setName("File extensions").setDesc("Comma-separated list of file extensions to track, e.g., md,mdx").addText(t=>t.setValue(this.plugin.settings.fileExtensions.join(",")).onChange(async s=>{this.plugin.settings.fileExtensions=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()})),new g.Setting(e).setName("Include folders").setDesc("Comma-separated list of folder paths to include (empty for all). Use {vault} or {root} to include only files directly in the vault root (no subfolders).").addText(t=>t.setValue(this.plugin.settings.includeFolders.join(",")).onChange(async s=>{this.plugin.settings.includeFolders=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()})),new g.Setting(e).setName("Exclude folders").setDesc("Comma-separated list of folder paths to exclude. Use {vault} or {root} to exclude files directly in the vault root (no subfolders).").addText(t=>t.setValue(this.plugin.settings.excludeFolders.join(",")).onChange(async s=>{this.plugin.settings.excludeFolders=s.split(",").map(i=>i.trim()).filter(i=>i),await this.plugin.saveSettings()}))}};var S=class{constructor(n,e){this.app=n;this.settings=e}async processAliases(n,e){let t=this.app.vault.getFileByPath(n);if(!t)return;let s=[];for(let a of this.settings.ignoreRegexes)try{s.push(new RegExp(a))}catch(o){console.error(`Invalid ignore regex: ${a}`,o)}let i=[],d=t.basename,h=d.toLowerCase();for(let a of e){if(s.some(m=>m.test(a)))continue;let o=a.toLowerCase();this.settings.caseSensitive&&a===d||!this.settings.caseSensitive&&o===h||i.push(a)}i.length!==0&&await this.app.fileManager.processFrontMatter(t,a=>{let o=a.aliases;if(!Array.isArray(o)){if(Object.keys(a).length>0&&!this.settings.autoCreateFrontmatter)return;o=[],a.aliases=o}let m=new Set(this.settings.caseSensitive?o:o.map(c=>c.toLowerCase()));for(let c of i){let u=this.settings.caseSensitive?c:c.toLowerCase();m.has(u)||(o.push(c),m.add(u))}})}};function T(r){return(r.split("/").pop()||"").replace(/\.[^/.]+$/,"")}function w(r){let n=r.split("/");return n.pop(),n.pop()||""}var v=class extends F.Plugin{constructor(){super(...arguments);this.debounceMap=new Map}async onload(){await this.loadSettings(),this.aliasProcessor=new S(this.app,this.settings),this.addSettingTab(new x(this.app,this)),this.registerEvent(this.app.vault.on("rename",this.handleRename.bind(this)))}onunload(){for(let e of this.debounceMap.values())e.timeoutId!==0&&window.clearTimeout(e.timeoutId);this.debounceMap.clear()}async loadSettings(){this.settings=Object.assign({},A,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}isPathInFolder(e,t){if(t.includes("{vault}")||t.includes("{root}")){let s=t.replace(/\{vault\}|\{root\}/g,"");return s===""||s==="/"?!e.includes("/"):e.startsWith(s+"/")||e===s}return e.startsWith(t+"/")||e===t}async handleRename(e,t){if(!(e instanceof F.TFile)||!this.settings.fileExtensions.includes(e.extension))return;let s=T(t),i=e.basename,d=w(t),h=w(e.path),a=this.settings.caseSensitive?s!==i:s.toLowerCase()!==i.toLowerCase(),o=d!==h&&!a;if(!a&&!o)return;let m=e.path;if(a&&(this.settings.includeFolders.length>0&&!this.settings.includeFolders.some(l=>this.isPathInFolder(m,l))||this.settings.excludeFolders.some(l=>this.isPathInFolder(m,l))))return;let c=[];for(let l of this.settings.ignoreRegexes)try{c.push(new RegExp(l))}catch(b){console.error(`Invalid ignore regex: ${l}`,b)}let u=null;if(a){if(c.some(l=>l.test(s)||l.test(i)))return;u=s}else if(o&&this.settings.trackFolderRenames&&this.settings.trackFolderRenames.trim()!==""){let l=e.basename;if(!(this.settings.caseSensitive?l===this.settings.trackFolderRenames:l.toLowerCase()===this.settings.trackFolderRenames.toLowerCase())||d===""||h===""||c.some(C=>C.test(d)||C.test(h)))return;u=d}if(!u)return;let p=this.debounceMap.get(e.path);p||(p=this.debounceMap.get(t),p&&this.debounceMap.delete(t)),p&&(p.timeoutId!==0&&window.clearTimeout(p.timeoutId),u=Array.from(p.queue)[0]);let f={queue:new Set([u]),timeoutId:0,currentPath:e.path};f.timeoutId=window.setTimeout(()=>{this.aliasProcessor.processAliases(f.currentPath,f.queue),this.debounceMap.delete(f.currentPath)},this.settings.timeoutSeconds*1e3),this.debounceMap.set(e.path,f)}};
