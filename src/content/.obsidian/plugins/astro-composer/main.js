/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var H=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var j=(T,n)=>{for(var e in n)H(T,e,{get:n[e],enumerable:!0})},z=(T,n,e,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Y(n))!U.call(T,i)&&i!==e&&H(T,i,{get:()=>n[i],enumerable:!(s=_(n,i))||s.enumerable});return T};var q=T=>z(H({},"__esModule",{value:!0}),T);var Z={};j(Z,{default:()=>W});module.exports=q(Z);var A=require("obsidian");var N=["tags","aliases","cssclasses"],M={DEBOUNCE_MS:500,STAT_MTIME_THRESHOLD:1e3,EDITOR_STABILIZE_DELAY:100,FILE_EXPLORER_REVEAL_DELAY:200};var R={enableUnderscorePrefix:!1,defaultTemplate:`---
title: "{{title}}"
date: {{date}}
tags: []
---
`,postsFolder:"posts",postsLinkBasePath:"blog/",automatePostCreation:!0,autoInsertProperties:!0,creationMode:"file",indexFileName:"",dateFormat:"YYYY-MM-DD",excludedDirectories:"",onlyAutomateInPostsFolder:!1,enablePages:!1,pagesFolder:"pages",pagesLinkBasePath:"",pagesCreationMode:"file",pagesIndexFileName:"",pageTemplate:`---
title: "{{title}}"
description: ""
---
`,enableCopyHeadingLink:!0,copyHeadingLinkFormat:"obsidian",addTrailingSlashToLinks:!1,customContentTypes:[]};var k=require("obsidian");var f=require("obsidian"),v=class{constructor(n,e,s){this.app=n;this.settings=e;this.plugin=s}toKebabCase(n){return n.toLowerCase().replace(/[<>:"/\\|?*]/g,"").replace(/['"]/g,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}generateFilename(n){let s=this.toKebabCase(n)||"untitled";return`${this.settings.enableUnderscorePrefix?"_":""}${s}`}determineType(n){let e=n.path;for(let a of this.settings.customContentTypes)if(a.enabled&&a.folder&&(e.startsWith(a.folder+"/")||e===a.folder))return a.id;let s=this.settings.pagesFolder||"",i=!1;if(this.settings.enablePages&&(s?i=e.startsWith(s+"/")||e===s:i=!e.includes("/")),i)return"page";let t=this.settings.postsFolder||"",o=!1;return this.settings.automatePostCreation&&(t?o=e.startsWith(t+"/")||e===t:o=!e.includes("/")),o?"post":"note"}getCustomContentType(n){return this.settings.customContentTypes.find(e=>e.id===n)||null}isCustomContentType(n){return n!=="post"&&n!=="page"}getTitleKey(n){if(n==="note")return"title";let e;if(this.isCustomContentType(n)){let t=this.getCustomContentType(n);if(!t)return"title";e=t.template}else e=n==="post"?this.settings.defaultTemplate:this.settings.pageTemplate;let s=e.split(`
`),i=!1;for(let t of s){let o=t.trim();if(o==="---"){i=!i;continue}if(i){let a=o.match(/^(\w+):\s*(.+)$/);if(a){let r=a[1];if(a[2].includes("{{title}}"))return r}}}return"title"}async createFile(n){var r,l;let{file:e,title:s,type:i}=n;if(!s)return new f.Notice(`Title is required to create a ${i}.`),null;let t=this.toKebabCase(s),o=this.settings.enableUnderscorePrefix?"_":"",a="";if(i==="note")a="";else if(this.isCustomContentType(i)){let c=this.getCustomContentType(i),d=((r=e.parent)==null?void 0:r.path)||"";d===""||d==="/"?a=c?c.folder:"":a=d}else{let c=this.settings.postsFolder||"",d=this.settings.pagesFolder||"",p=((l=e.parent)==null?void 0:l.path)||"";p===""||p==="/"?a="":a=p}return a&&(this.app.vault.getAbstractFileByPath(a)instanceof f.TFolder||await this.app.vault.createFolder(a)),this.settings.creationMode==="folder"?this.createFolderStructure(e,t,o,a,i):this.createFileStructure(e,t,o,a)}async createFolderStructure(n,e,s,i,t){let o=`${s}${e}`,a;if(i)a=`${i}/${o}`;else{let p=n.parent?n.parent.path:"";p&&p!=="/"?a=`${p}/${o}`:a=o}try{this.app.vault.getAbstractFileByPath(a)instanceof f.TFolder||await this.app.vault.createFolder(a)}catch(p){}let l=`${this.settings.indexFileName||"index"}.md`,c=`${a}/${l}`;if(this.app.vault.getAbstractFileByPath(c)instanceof f.TFile)return new f.Notice(`File already exists at ${c}.`),null;try{await this.app.vault.rename(n,c);let p=this.app.vault.getAbstractFileByPath(c);return p instanceof f.TFile?(setTimeout(()=>{let h=this.app.workspace.getLeavesOfType("file-explorer")[0];if(h&&h.view){let C=h.view;if(C&&typeof C=="object"&&"tree"in C){let g=C.tree;g&&p instanceof f.TFile&&typeof g.revealFile=="function"&&g.revealFile(p)}}},200),await this.app.workspace.getLeaf(!1).openFile(p),p):null}catch(p){let m=p instanceof Error?p.message:String(p);return new f.Notice(`Failed to create folder structure: ${m}.`),null}}async createFileStructure(n,e,s,i){var r;let t=`${s}${e}.md`,o;if(i)o=`${i}/${t}`;else{let l=n.parent?n.parent.path:"";l&&l!=="/"?o=`${l}/${t}`:o=t}let a=this.app.vault.getAbstractFileByPath(o);if(a instanceof f.TFile&&a!==n)return new f.Notice(`File with name "${t}" already exists.`),null;try{await this.app.fileManager.renameFile(n,o);let l=this.app.vault.getAbstractFileByPath(o);return l instanceof f.TFile?(this.plugin&&"pluginCreatedFiles"in this.plugin&&((r=this.plugin.pluginCreatedFiles)==null||r.add(o)),await this.app.workspace.getLeaf(!1).openFile(l),l):(new f.Notice("Failed to locate renamed file."),null)}catch(l){let c=l instanceof Error?l.message:String(l);return new f.Notice(`Failed to rename file: ${c}.`),null}}async renameFile(n){let{file:e,title:s,type:i}=n;if(!s)return new f.Notice("Title is required to rename the content."),null;let t=this.toKebabCase(s),o="";return this.settings.creationMode==="folder"?this.renameFolderStructure(e,t,o,i):this.renameFileStructure(e,t,o)}async renameFolderStructure(n,e,s,i){let t=this.settings.indexFileName||"index";if(n.basename===t){if(!n.parent)return new f.Notice("Cannot rename: File has no parent folder."),null;s=n.parent.name.startsWith("_")?"_":"";let a=`${s}${e}`,r=n.parent.parent;if(!r)return new f.Notice("Cannot rename: Parent folder has no parent."),null;let l;if(r.path===""||r.path==="/"?l=a:l=`${r.path}/${a}`,this.app.vault.getAbstractFileByPath(l)instanceof f.TFolder)return new f.Notice(`Folder already exists at ${l}.`),null;try{await this.app.fileManager.renameFile(n.parent,l)}catch(m){let h=m instanceof Error?m.message:String(m);return new f.Notice(`Failed to rename folder: ${h}.`),null}let d=`${l}/${n.name}`,p=this.app.vault.getAbstractFileByPath(d);return p instanceof f.TFile?p:(new f.Notice("Failed to locate renamed file."),null)}else{if(!n.parent)return new f.Notice("Cannot rename: File has no parent folder."),null;s=n.basename.startsWith("_")?"_":"";let a=`${s}${e}.md`,r=`${n.parent.path}/${a}`,l=this.app.vault.getAbstractFileByPath(r);if(l instanceof f.TFile&&l!==n)return new f.Notice(`File already exists at ${r}.`),null;let c=n.path,d=n.name;await this.app.vault.rename(n,r);let p=this.app.vault.getAbstractFileByPath(r);return p instanceof f.TFile?p:(new f.Notice("Failed to locate renamed file."),null)}}async renameFileStructure(n,e,s){if(!n.parent)return new f.Notice("Cannot rename: File has no parent folder."),null;if(this.settings.indexFileName&&this.settings.indexFileName.trim()!==""&&n.basename===this.settings.indexFileName){s=n.parent.name.startsWith("_")?"_":"";let l=`${s}${e}`,c=n.parent.parent;if(!c)return new f.Notice("Cannot rename: Parent folder has no parent."),null;let d;if(c.path===""||c.path==="/"?d=l:d=`${c.path}/${l}`,this.app.vault.getAbstractFileByPath(d)instanceof f.TFolder)return new f.Notice(`Folder already exists at ${d}.`),null;let m=n.path,h=n.name;try{await this.app.fileManager.renameFile(n.parent,d)}catch(y){console.error("FileOperations: Folder rename failed:",y);let P=y instanceof Error?y.message:String(y);return new f.Notice(`Failed to rename folder: ${P}.`),null}let C=`${d}/${n.name}`,g=this.app.vault.getAbstractFileByPath(C);return g instanceof f.TFile?g:(new f.Notice("Failed to locate renamed file."),null)}s=n.basename.startsWith("_")?"_":"";let t=`${s}${e}.md`,o;n.parent.path===""||n.parent.path==="/"?o=t:o=`${n.parent.path}/${t}`;let a=this.app.vault.getAbstractFileByPath(o);if(a instanceof f.TFile&&a!==n)return new f.Notice(`File already exists at ${o}.`),null;try{await this.app.fileManager.renameFile(n,o)}catch(l){console.error("FileOperations: File rename failed:",l);let c=l instanceof Error?l.message:String(l);return new f.Notice(`Failed to rename file: ${c}.`),null}let r=this.app.vault.getAbstractFileByPath(o);return r instanceof f.TFile?r:(new f.Notice("Failed to locate renamed file."),null)}};var B=require("obsidian");var $=class{constructor(n,e){this.app=n;this.settings=e}async parseFrontmatter(n){let e=0,s="",i={};if(n.startsWith("---")){e=n.indexOf(`
---`,3),e===-1?e=n.length:e+=4,s=n.slice(4,e-4).trim();try{let o=null,a=new Set;s.split(`
`).forEach(r=>{let l=r.trim(),c=l.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(c){let[,d,p]=c;o=d;let m=N.includes(d),h=!p||p.trim()===""||p.trim()==="[]";m||h?(i[d]=[],a.add(d)):i[d]=[p?p.trim():""]}else if(o&&l.startsWith("- ")){if(a.has(o)){let p=l.replace(/^-\s*/,"");p&&i[o].push(p)}}else if(l&&!l.startsWith("- ")&&!l.startsWith("#")){let d=l.match(/^([^:]+):\s*(.*)$/);if(d){let[,p,m]=d;i[p]||(i[p]=[m?m.trim():""])}}}),N.forEach(r=>{s.includes(r+":")&&!i[r]&&(i[r]=[])})}catch(o){new B.Notice("Falling back to template due to parsing error.")}}let t=n.slice(e);return{properties:i,propertiesText:s,propertiesEnd:e,bodyContent:t}}parseTemplate(n,e){let s=n.split(`
`),i=[],t={},o=!1;for(let a=0;a<s.length;a++){let r=s[a].trim();if(r==="---"){if(o=!o,!o)break;continue}if(o){let l=r.match(/^(\w+):\s*(.*)$/);if(l){let[,c,d]=l;i.push(c);let p=N.includes(c),m=!d||d.trim()===""||d.trim()==="[]";if(p||m)if(d&&d.startsWith("[")){let C=d.replace(/[[\]]/g,"").split(",").map(g=>g.trim()).filter(g=>g);t[c]=C}else{t[c]=[];for(let C=a+1;C<s.length;C++){let g=s[C].trim();if(g.startsWith("- ")){let y=g.replace(/^-\s*/,"").trim();y&&t[c].push(y)}else if(g==="---"||g&&!g.startsWith("- ")&&g.includes(":"))break}}else{let C=(d||"").replace(/\{\{title\}\}/g,e).replace(/\{\{date\}\}/g,window.moment(new Date).format(this.settings.dateFormat));t[c]=C}}}}return{templateProps:i,templateValues:t}}buildFrontmatterContent(n,e){let s=`---
`;for(let i in n)N.includes(i)||e&&e.has(i)?(s+=`${i}:
`,n[i].length>0&&n[i].forEach(o=>{s+=`  - ${o}
`})):s+=`${i}: ${n[i][0]||""}
`;return s+="---",s}async updateTitleInFrontmatter(n,e,s){let i=this.getTitleKey(s),t=await this.app.vault.read(n),o=0,a="";t.startsWith("---")&&(o=t.indexOf(`
---`,3),o===-1?o=t.length:o+=4,a=t.slice(4,o-4).trim());let r=[],l={},c=null,d=-1,p=new Set;a.split(`
`).forEach((g,y)=>{let P=g.trim(),x=P.match(/^([a-zA-Z_][a-zA-Z0-9_-]*):\s*(.*)$/);if(x){let[,w,u]=x;r.push(w),c=w,w===i&&(d=y);let F=N.includes(w),K=!u||u.trim()===""||u.trim()==="[]";F||K?(l[w]=[],p.add(w)):l[w]=u?u.trim():""}else if(c&&p.has(c)&&P.startsWith("- ")){let w=P.replace(/^-\s*/,"");w&&l[c].push(w)}else if(P&&!P.startsWith("- ")&&!P.startsWith("#")){let w=P.match(/^([^:]+):\s*(.*)$/);if(w){let[,u,F]=w;r.includes(u)||(r.push(u),l[u]=F?F.trim():"")}}});let m;e.includes('"')||e.includes("'")||e.includes(`
`)||e.includes("\\")?m=`'${e.replace(/'/g,"''")}'`:e.includes(" ")||e.includes(":")||e.includes("#")||e.includes("@")?m=`"${e.replace(/"/g,'\\"')}"`:m=e,l[i]=m,d===-1&&r.push(i);let h=`---
`;for(let g of r){let y=l[g];Array.isArray(y)?(h+=`${g}:
`,y.length>0&&y.forEach(P=>{h+=`  - ${P}
`})):h+=`${g}: ${y||""}
`}h+="---";let C=t.slice(o);h+=C,await this.app.vault.modify(n,h)}getTitleKey(n){let e;if(this.isCustomContentType(n)){let t=this.getCustomContentType(n);if(!t)return"title";e=t.template}else e=n==="post"?this.settings.defaultTemplate:this.settings.pageTemplate;let s=e.split(`
`),i=!1;for(let t of s){let o=t.trim();if(o==="---"){i=!i;continue}if(i){let a=o.match(/^(\w+):\s*(.+)$/);if(a){let r=a[1];if(a[2].includes("{{title}}"))return r}}}return"title"}isCustomContentType(n){return n!=="post"&&n!=="page"}getCustomContentType(n){return this.settings.customContentTypes.find(e=>e.id===n)||null}};var E=require("obsidian"),S=class{constructor(n){this.settings=n}toKebabCase(n){return n.toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}getAstroUrlFromInternalLink(n){let e=n.indexOf("#"),s=e>=0?n.slice(0,e):n,i=e>=0?n.slice(e):"";s=decodeURIComponent(s),s=s.replace(/\.md$/,"");let t="",o="",a="file",r="",l=!1;for(let g of this.settings.customContentTypes)if(g.enabled&&g.folder&&s.startsWith(g.folder+"/")){o=g.folder,t=g.linkBasePath||"",a=g.creationMode,r=g.indexFileName,l=!0;break}if(!l&&this.settings.enablePages&&this.settings.pagesFolder&&s.startsWith(this.settings.pagesFolder+"/"))o=this.settings.pagesFolder,t=this.settings.pagesLinkBasePath,a=this.settings.pagesCreationMode||"file",r=this.settings.pagesIndexFileName||"";else if(!l&&this.settings.postsFolder&&s.startsWith(this.settings.postsFolder+"/"))o=this.settings.postsFolder,t=this.settings.postsLinkBasePath,a=this.settings.creationMode,r=this.settings.indexFileName||"index";else if(!l&&!this.settings.postsFolder&&!this.settings.onlyAutomateInPostsFolder&&(!s.includes("/")||s.includes("/")&&!s.startsWith("/")&&s.split("/").length===2)){let g=!1;if(this.settings.enablePages&&this.settings.pagesFolder&&s.startsWith(this.settings.pagesFolder+"/")&&(g=!0),this.settings.excludedDirectories){let y=this.settings.excludedDirectories.split("|").map(P=>P.trim()).filter(P=>P);for(let P of y)if(s.startsWith(P+"/")||s===P){g=!0;break}}g||(t=this.settings.postsLinkBasePath,a=this.settings.creationMode,r=this.settings.indexFileName||"index")}o&&(s=s.slice(o.length+1));let c=!1,d=s.split("/"),p=d[d.length-1];(r&&r.trim()!==""&&p===r||(!r||r.trim()==="")&&p==="index")&&(d.pop(),s=d.join("/"),c=!0);let h=s.split("/").map(g=>this.toKebabCase(g)).join("/");t?(t.startsWith("/")||(t="/"+t),t.endsWith("/")||(t+="/")):t="/";let C=this.settings.addTrailingSlashToLinks||c;return`${t}${h}${C?"/":""}${i}`}getAstroUrlFromInternalLinkWithContext(n,e,s){let i=n.indexOf("#"),t=i>=0?n.slice(0,i):n,o=i>=0?n.slice(i):"";t=decodeURIComponent(t),t=t.replace(/\.md$/,"");let a="",r="",l="file",c="",d=this.getContentTypeForPath(t+".md");!d.basePath&&s.basePath?(a=s.basePath,l=s.creationMode,c=s.indexFileName):(a=d.basePath,l=d.creationMode,c=d.indexFileName);let p=t+".md";for(let x of this.settings.customContentTypes)if(x.enabled&&x.folder&&p.startsWith(x.folder+"/")){r=x.folder;break}!r&&this.settings.enablePages&&this.settings.pagesFolder&&p.startsWith(this.settings.pagesFolder+"/")&&(r=this.settings.pagesFolder),!r&&this.settings.postsFolder&&p.startsWith(this.settings.postsFolder+"/")&&(r=this.settings.postsFolder),r&&(t=t.slice(r.length+1));let m=!1,h=t.split("/"),C=h[h.length-1];(c&&c.trim()!==""&&C===c||(!c||c.trim()==="")&&C==="index")&&(h.pop(),t=h.join("/"),m=!0);let y=t.split("/").map(x=>this.toKebabCase(x)).join("/");a?(a.startsWith("/")||(a="/"+a),a.endsWith("/")||(a+="/")):a="/";let P=this.settings.addTrailingSlashToLinks||m;return`${a}${y}${P?"/":""}${o}`}isInConfiguredContentDirectory(n){for(let e of this.settings.customContentTypes)if(e.enabled&&e.folder&&n.startsWith(e.folder+"/"))return!0;if(this.settings.enablePages){if(this.settings.pagesFolder&&n.startsWith(this.settings.pagesFolder+"/"))return!0;if(!this.settings.pagesFolder&&!n.includes("/"))return!0}return this.settings.postsFolder&&n.startsWith(this.settings.postsFolder+"/")?!0:!!(!this.settings.postsFolder&&this.settings.automatePostCreation&&!n.includes("/"))}getContentTypeForPath(n){for(let e of this.settings.customContentTypes)if(e.enabled&&e.folder&&n.startsWith(e.folder+"/"))return{basePath:e.linkBasePath||"",creationMode:e.creationMode,indexFileName:e.indexFileName};if(this.settings.enablePages){if(this.settings.pagesFolder&&n.startsWith(this.settings.pagesFolder+"/"))return{basePath:this.settings.pagesLinkBasePath,creationMode:this.settings.pagesCreationMode||"file",indexFileName:this.settings.pagesIndexFileName||""};if(!this.settings.pagesFolder&&!n.includes("/"))return{basePath:this.settings.pagesLinkBasePath,creationMode:this.settings.pagesCreationMode||"file",indexFileName:this.settings.pagesIndexFileName||""}}return this.settings.postsFolder&&n.startsWith(this.settings.postsFolder+"/")?{basePath:this.settings.postsLinkBasePath,creationMode:this.settings.creationMode,indexFileName:this.settings.indexFileName||"index"}:!this.settings.postsFolder&&this.settings.automatePostCreation?{basePath:this.settings.postsLinkBasePath,creationMode:this.settings.creationMode,indexFileName:this.settings.indexFileName||"index"}:{basePath:"",creationMode:"file",indexFileName:""}}async convertWikilinksForAstro(n,e){if(!(e instanceof E.TFile)){new E.Notice("No active file.");return}let i=n.getValue(),t=0,o=0,a=[],r=this.getContentTypeForPath(e.path),l=/\.(png|jpg|jpeg|gif|svg)$/i,c=d=>{if(l.test(d)||d.match(/^https?:\/\//)||!d.includes(".md")&&!d.match(/^[a-zA-Z0-9_-]+(\/[a-zA-Z0-9_-]+)*$/))return!1;let p=d.endsWith(".md")?d:d+".md",m=this.isInConfiguredContentDirectory(p),h=!p.includes("/"),C=r.basePath!==""||r.creationMode!=="file"||r.indexFileName!=="";return m||h&&C};i=i.replace(/\[\[([^\]|]+)(\|([^\]]+))?\]\]/g,(d,p,m,h)=>{if(l.test(p)||!c(p))return o++,a.push(p),d;let C=h||p.replace(/\.md$/,""),g=this.getAstroUrlFromInternalLinkWithContext(p,e.path,r);return t++,`[${C}](${g})`}),i=i.replace(/\[([^\]]+)\]\(([^)]+\.md[^)]*)\)/g,(d,p,m)=>{if(m.match(/^https?:\/\//)||l.test(m)||!c(m))return o++,a.push(m),d;let h=this.getAstroUrlFromInternalLinkWithContext(m,e.path,r);return t++,`[${p}](${h})`}),i=i.replace(/!\[(.*?)\]\(([^)]+)\)/g,d=>(o++,d)),i=i.replace(/\{\{([^}]+)\}\}/g,(d,p)=>{if(l.test(p)||!c(p))return o++,a.push(p),d;let m=this.getAstroUrlFromInternalLinkWithContext(p,e.path,r);return t++,`[Embedded: ${p}](${m})`}),n.setValue(i),t>0&&o===0?new E.Notice(`Converted ${t} internal link${t>1?"s":""} for Astro.`):t>0&&o>0?new E.Notice(`Converted ${t} link${t>1?"s":""} for Astro. Skipped ${o} link${o>1?"s":""} outside configured content directories.`):o>0?new E.Notice(`No links converted. All ${o} link${o>1?"s":""} are outside configured content directories or are images/external links.`):new E.Notice("No internal links found to convert.")}};var D=require("obsidian");var L=class extends D.Modal{constructor(e,s,i,t="post",o=!1,a=!1){super(e);this.file=s,this.plugin=i,this.type=t,this.isRename=o,this.isNewNote=a;let r=i.settings;this.fileOps=new v(e,r),this.templateParser=new $(e,r)}getCurrentTitle(){if(!this.file)return"";let e=this.fileOps.getTitleKey(this.type),s=this.app.metadataCache.getFileCache(this.file),i=this.file.basename;this.file.parent&&this.plugin.settings.indexFileName&&this.plugin.settings.indexFileName.trim()!==""&&i===this.plugin.settings.indexFileName&&(i=this.file.parent.name),i.startsWith("_")&&(i=i.slice(1));let t=i.replace(/-/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return s!=null&&s.frontmatter&&s.frontmatter[e]?s.frontmatter[e]:t}onOpen(){let{contentEl:e}=this;if(e.empty(),(window.innerWidth<=768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))&&this.modalEl.addClass("astro-composer-mobile-modal"),this.isRename){let a=this.getTypeDisplayName();this.fileOps.isCustomContentType(this.type)?(e.createEl("h2",{text:`Rename Custom Type: ${a}`}),e.createEl("p",{text:"Enter a new title for this content type:"})):this.type==="note"?(e.createEl("h2",{text:"Rename Custom Content Type"}),e.createEl("p",{text:"Enter a title for this content type:"})):(e.createEl("h2",{text:`Rename ${a}`}),e.createEl("p",{text:`Enter new title for your ${a.toLowerCase()}:`})),this.titleInput=e.createEl("input",{type:"text",placeholder:`My Renamed ${a}`,cls:"astro-composer-title-input"}),this.titleInput.value=this.getCurrentTitle()}else if(this.isNewNote){let a=this.getTypeDisplayName();this.fileOps.isCustomContentType(this.type)?(e.createEl("h2",{text:`New Custom Type: ${a}`}),e.createEl("p",{text:"Enter a title for this content type:"})):(e.createEl("h2",{text:`Create New ${a}`}),e.createEl("p",{text:`Enter a title for your new ${a.toLowerCase()}:`})),this.titleInput=e.createEl("input",{type:"text",placeholder:`My Awesome ${a}`,cls:"astro-composer-title-input"})}else{let a=this.getTypeDisplayName();this.fileOps.isCustomContentType(this.type)?(e.createEl("h2",{text:`New Custom Type: ${a}`}),e.createEl("p",{text:"Enter a title for this content type:"})):(e.createEl("h2",{text:`New ${a}`}),e.createEl("p",{text:`Enter a title for your ${a.toLowerCase()}:`})),this.titleInput=e.createEl("input",{type:"text",placeholder:`My Awesome ${a}`,cls:"astro-composer-title-input"})}this.titleInput.focus();let i=e.createDiv({cls:"astro-composer-button-container"}),t=i.createEl("button",{text:"Cancel",cls:"astro-composer-cancel-button"});t.onclick=()=>this.close();let o=i.createEl("button",{text:this.isRename?"Rename":"Create",cls:["astro-composer-create-button","mod-cta"]});o.onclick=()=>this.submit(),this.titleInput.addEventListener("keypress",a=>{a.key==="Enter"&&this.submit()})}async submit(){let e=this.titleInput.value.trim();if(!e){new D.Notice("Please enter a title.");return}try{let s=null;if(this.isRename)if(s=await this.fileOps.renameFile({file:this.file,title:e,type:this.type}),s)await this.templateParser.updateTitleInFrontmatter(s,e,this.type);else{this.close();return}else this.isNewNote?s=await this.createNewFile(e):this.file?(s=await this.fileOps.createFile({file:this.file,title:e,type:this.type}),s&&this.plugin.settings.autoInsertProperties&&await this.addPropertiesToFile(s,e,this.type)):s=await this.createNewFile(e);if(!s){new D.Notice(`Failed to ${this.isRename?"rename":"create"} ${this.type}.`),this.close();return}}catch(s){console.error("TitleModal: Error during process:",s);let i=s instanceof Error?s.message:String(s);new D.Notice(`Error ${this.isRename?"renaming":"creating"} ${this.type}: ${i}.`),this.close();return}this.close()}getTypeDisplayName(){if(this.fileOps.isCustomContentType(this.type)){let e=this.fileOps.getCustomContentType(this.type);return e?e.name:"Content"}return this.type==="post"?"Blog Post":"Page"}async createNewFile(e){var r,l,c;let s,i=((l=(r=this.file)==null?void 0:r.parent)==null?void 0:l.path)||"";if(this.fileOps.isCustomContentType(this.type)){let d=this.fileOps.getCustomContentType(this.type);i===""||i==="/"?s=(d==null?void 0:d.folder)||"":s=i}else this.type==="page"?s=this.plugin.settings.pagesFolder||i:s=this.plugin.settings.postsFolder||i;let t=this.fileOps.generateFilename(e),o=s?`${s}/${t}.md`:`${t}.md`,a="";this.plugin.settings.autoInsertProperties&&(a=await this.generateInitialContent(e));try{let d=await this.app.vault.create(o,a);return this.plugin&&"pluginCreatedFiles"in this.plugin&&((c=this.plugin.pluginCreatedFiles)==null||c.add(o)),await this.app.workspace.getLeaf().openFile(d),d}catch(d){let p=d instanceof Error?d.message:String(d);throw new Error(`Failed to create file: ${p}`)}}async generateInitialContent(e){let s=new Date,i=window.moment(s).format(this.plugin.settings.dateFormat),t;if(this.type==="note")t=`---
title: ${this.escapeYamlString(e)}
date: ${i}
---
`;else if(this.fileOps.isCustomContentType(this.type)){let o=this.fileOps.getCustomContentType(this.type);t=o?o.template:this.plugin.settings.defaultTemplate}else t=this.type==="post"?this.plugin.settings.defaultTemplate:this.plugin.settings.pageTemplate;return t=t.replace(/\{\{title\}\}/g,e),t=t.replace(/\{\{date\}\}/g,i),t}async addPropertiesToFile(e,s,i="post"){let t=new Date,o=window.moment(t).format(this.plugin.settings.dateFormat),a;if(i==="note")a=`---
title: ${this.escapeYamlString(s)}
date: ${o}
---
`;else if(this.fileOps.isCustomContentType(i)){let r=this.fileOps.getCustomContentType(i);a=r?r.template:this.plugin.settings.defaultTemplate}else a=i==="post"?this.plugin.settings.defaultTemplate:this.plugin.settings.pageTemplate;a=a.replace(/\{\{title\}\}/g,s),a=a.replace(/\{\{date\}\}/g,o),await this.app.vault.modify(e,a)}escapeYamlString(e){return e.includes('"')||e.includes("'")||e.includes(`
`)||e.includes("\\")?`'${e.replace(/'/g,"''")}'`:e.includes(" ")||e.includes(":")||e.includes("#")||e.includes("@")?`"${e.replace(/"/g,'\\"')}"`:e}onClose(){let{contentEl:e}=this;e.empty()}};function V(T,n){let e=new v(T.app,n,T),s=new S(n);function i(t,o){let a=t.path,r=o.postsFolder||"",l=o.enablePages&&o.pagesFolder||"";if(o.automatePostCreation){if(r){if(a.startsWith(r+"/")||a===r)return!0}else if(!a.includes("/")||a.includes("/")&&!a.startsWith("/")&&a.split("/").length===2)return!0}if(o.enablePages){if(l&&(a.startsWith(l+"/")||a===l))return!0;if(!l&&!a.includes("/"))return!0}let c=e.determineType(t);if(e.isCustomContentType(c)){let d=e.getCustomContentType(c);if(d&&d.enabled)return!0}return!1}T.addCommand({id:"standardize-properties",name:"Standardize Properties",icon:"file-check",editorCallback:(t,o)=>{o.file instanceof k.TFile&&G(T.app,n,o.file,T)}}),T.addCommand({id:"convert-wikilinks-astro",name:"Convert internal links for Astro",icon:"link-2",editorCallback:(t,o)=>{o.file instanceof k.TFile&&s.convertWikilinksForAstro(t,o.file)}}),T.addCommand({id:"rename-content",name:"Rename Current Content",icon:"pencil",editorCallback:(t,o)=>{if(o.file instanceof k.TFile){if(!i(o.file,n)){new k.Notice("Cannot rename: This file is not part of a configured content type folder.");return}let a=e.determineType(o.file),r=T.app.metadataCache.getFileCache(o.file),l=e.getTitleKey(a);if(!(r!=null&&r.frontmatter)||!(l in r.frontmatter)){new k.Notice(`Cannot rename: No ${l} found in properties`);return}new L(T.app,o.file,T,a,!0).open()}}})}async function G(T,n,e,s){let i=new $(T,n),t=new v(T,n,s),o=t.determineType(e);if(o==="note"){new k.Notice("No properties template specified for this content. This file doesn't match any configured content type folders.");return}let a;if(t.isCustomContentType(o)){let g=t.getCustomContentType(o);a=g?g.template:n.defaultTemplate}else a=o==="page"?n.pageTemplate:n.defaultTemplate;await new Promise(g=>setTimeout(g,100));let r=await T.vault.read(e),l=e.basename.replace(/^_/,""),c=await i.parseFrontmatter(r),{templateProps:d,templateValues:p}=i.parseTemplate(a,l),m={...c.properties},h=new Set;for(let g of d)if(g in c.properties){let y=p[g];if(Array.isArray(y)){let x=c.properties[g]||[],w=y.filter(u=>!x.includes(u));m[g]=[...x,...w],h.add(g)}}else{let y=p[g];Array.isArray(y)?(m[g]=y,h.add(g)):m[g]=[y||""]}for(let g in c.properties)c.properties[g].length>1&&h.add(g);let C=i.buildFrontmatterContent(m,h)+c.bodyContent;await T.vault.modify(e,C),new k.Notice("Properties standardized using template.")}var b=require("obsidian"),I=class extends b.PluginSettingTab{constructor(e,s){super(e,s);this.autoRenameContainer=null;this.postsFolderContainer=null;this.onlyAutomateContainer=null;this.creationModeContainer=null;this.indexFileContainer=null;this.excludedDirsContainer=null;this.underscorePrefixContainer=null;this.autoInsertContainer=null;this.pagesFieldsContainer=null;this.pagesIndexFileContainer=null;this.copyHeadingContainer=null;this.customContentTypesContainer=null;this.plugin=s}display(){let{containerEl:e}=this;e.empty();let s=this.plugin.settings;new b.Setting(e).setName("Date format").setDesc("Format for the date in properties (e.g., YYYY-MM-DD, MMMM D, YYYY, YYYY-MM-DD HH:mm).").addText(i=>i.setPlaceholder("YYYY-MM-DD").setValue(s.dateFormat).onChange(async t=>{s.dateFormat=t||"YYYY-MM-DD",await this.plugin.saveSettings()})),new b.Setting(e).setName("Enable copy heading links").setDesc("Add right-click context menu option to copy heading links in various formats.").addToggle(i=>i.setValue(s.enableCopyHeadingLink).onChange(async t=>{s.enableCopyHeadingLink=t,await this.plugin.saveSettings(),this.updateCopyHeadingFields()})),this.copyHeadingContainer=e.createDiv({cls:"copy-heading-fields"}),this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-visible",s.enableCopyHeadingLink),this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-hidden",!s.enableCopyHeadingLink),new b.Setting(this.copyHeadingContainer).setName("Default heading link format").setDesc("Choose the default format for copied heading links. Obsidian format respects your Obsidian settings for wikilink vs markdown preference. Astro link uses your Link base path from above and converts the heading into kebab-case format as an anchor link.").addDropdown(i=>i.addOption("obsidian","Obsidian link").addOption("astro","Astro link").setValue(s.copyHeadingLinkFormat).onChange(async t=>{s.copyHeadingLinkFormat=t,await this.plugin.saveSettings()})),new b.Setting(e).setName("Add trailing slash to links").setDesc("Add trailing slashes to all converted internal links (e.g., /about/ instead of /about).").addToggle(i=>i.setValue(s.addTrailingSlashToLinks).onChange(async t=>{s.addTrailingSlashToLinks=t,await this.plugin.saveSettings()})),new b.Setting(e).setName("Post settings").setDesc("").setHeading(),new b.Setting(e).setName("Automate post creation").setDesc("Automatically show title dialog for new .md files, rename them based on the title, and insert properties if enabled.").addToggle(i=>i.setValue(s.automatePostCreation).onChange(async t=>{s.automatePostCreation=t,s.autoInsertProperties=t,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),this.updateConditionalFields()})),this.autoRenameContainer=e.createDiv({cls:"auto-rename-fields"}),this.autoRenameContainer.classList.toggle("astro-composer-setting-container-visible",s.automatePostCreation),this.autoRenameContainer.classList.toggle("astro-composer-setting-container-hidden",!s.automatePostCreation),this.autoInsertContainer=this.autoRenameContainer.createDiv(),new b.Setting(this.autoInsertContainer).setName("Auto-insert properties").setDesc("Automatically insert the properties template when creating new files (requires 'Automate post creation' to be enabled).").addToggle(i=>i.setValue(s.autoInsertProperties).setDisabled(!s.automatePostCreation).onChange(async t=>{s.autoInsertProperties=t,await this.plugin.saveSettings()})),this.postsFolderContainer=this.autoRenameContainer.createDiv(),new b.Setting(this.postsFolderContainer).setName("Posts folder").setDesc("Folder name for blog posts (leave blank to use the vault folder). You can specify the default location for new notes in Obsidian's 'Files and links' settings.").addText(i=>i.setPlaceholder("Enter folder path").setValue(s.postsFolder).onChange(async t=>{s.postsFolder=t,await this.plugin.saveSettings(),this.updateOnlyAutomateField(),this.updateExcludedDirsField()})),this.onlyAutomateContainer=this.autoRenameContainer.createDiv(),new b.Setting(this.onlyAutomateContainer).setName("Ignore subfolders").setDesc("When enabled, automation will only trigger for new .md files within the Posts folder and one level down (for folder-based posts). Files in deeper subfolders will be ignored.").addToggle(i=>i.setValue(s.onlyAutomateInPostsFolder).onChange(async t=>{s.onlyAutomateInPostsFolder=t,await this.plugin.saveSettings(),this.updateExcludedDirsField()})),this.excludedDirsContainer=this.autoRenameContainer.createDiv({cls:"excluded-dirs-field"}),this.excludedDirsContainer.classList.toggle("astro-composer-setting-container-visible",!s.onlyAutomateInPostsFolder),this.excludedDirsContainer.classList.toggle("astro-composer-setting-container-hidden",s.onlyAutomateInPostsFolder),new b.Setting(this.excludedDirsContainer).setName("Excluded directories").setDesc("Directories to exclude from automatic post creation (e.g., pages|posts/example). Excluded directories and their child folders will be ignored. Use '|' to separate multiple directories.").addText(i=>i.setPlaceholder("pages|posts/example").setValue(s.excludedDirectories).onChange(async t=>{s.excludedDirectories=t,await this.plugin.saveSettings()})),new b.Setting(this.autoRenameContainer).setName("Posts link base path").setDesc("Base path for converted links in posts (e.g., /blog/, leave blank for root /).").addText(i=>i.setPlaceholder("/blog/").setValue(s.postsLinkBasePath).onChange(async t=>{s.postsLinkBasePath=t,await this.plugin.saveSettings()})),this.creationModeContainer=this.autoRenameContainer.createDiv(),new b.Setting(this.creationModeContainer).setName("Creation mode").setDesc("How to create new entries: file-based or folder-based with an index file.").addDropdown(i=>i.addOption("file","File-based (post-title.md)").addOption("folder","Folder-based (post-title/index.md)").setValue(s.creationMode).onChange(async t=>{s.creationMode=t,await this.plugin.saveSettings(),this.updateIndexFileField()})),this.indexFileContainer=this.autoRenameContainer.createDiv({cls:"index-file-field"}),this.indexFileContainer.classList.toggle("astro-composer-setting-container-visible",s.creationMode==="folder"),this.indexFileContainer.classList.toggle("astro-composer-setting-container-hidden",s.creationMode!=="folder"),new b.Setting(this.indexFileContainer).setName("Index file name").setDesc("Name for index files in folder-based content (without .md extension). Defaults to 'index' if left blank.").addText(i=>i.setPlaceholder("index").setValue(s.indexFileName).onChange(async t=>{s.indexFileName=t,await this.plugin.saveSettings()})),this.underscorePrefixContainer=this.autoRenameContainer.createDiv(),new b.Setting(this.underscorePrefixContainer).setName("Use underscore prefix for drafts").setDesc("Add an underscore prefix (_post-title) to new notes by default when enabled. This hides them from Astro, which can be helpful for post drafts. Disable to skip prefixing.").addToggle(i=>i.setValue(s.enableUnderscorePrefix).onChange(async t=>{s.enableUnderscorePrefix=t,await this.plugin.saveSettings()})),new b.Setting(e).setName("Post properties template").addTextArea(i=>(i.setPlaceholder(`---
title: "{{title}}"
date: {{date}}
tags: []
---
`).setValue(s.defaultTemplate).onChange(async t=>{s.defaultTemplate=t,await this.plugin.saveSettings()}),i.inputEl.classList.add("astro-composer-template-textarea"),i)).then(i=>{i.descEl.empty();let t=i.descEl.createEl("div");t.createEl("div",{text:"Used for new posts and when standardizing properties."}),t.createEl("div",{text:"Variables include {{title}} and {{date}}."}),t.createEl("div",{text:"Do not wrap {{date}} in quotes as it represents a datetime value, not a string."}),t.createEl("div",{text:"The 'standardize properties' command ignores anything below the second '---' line."})}),new b.Setting(e).setName("Page settings").setDesc("").setHeading(),new b.Setting(e).setName("Enable pages").setDesc("Enable page content type for static pages.").addToggle(i=>i.setValue(s.enablePages).onChange(async t=>{s.enablePages=t,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),this.updatePagesFields()})),this.pagesFieldsContainer=e.createDiv({cls:"pages-fields"}),this.pagesFieldsContainer.classList.toggle("astro-composer-setting-container-visible",s.enablePages),this.pagesFieldsContainer.classList.toggle("astro-composer-setting-container-hidden",!s.enablePages),new b.Setting(this.pagesFieldsContainer).setName("Pages folder").setDesc("Folder name for pages (leave blank to use the vault folder).").addText(i=>i.setPlaceholder("Enter folder path").setValue(s.pagesFolder).onChange(async t=>{s.pagesFolder=t,await this.plugin.saveSettings()})),new b.Setting(this.pagesFieldsContainer).setName("Pages link base path").setDesc("Base path for converted links in pages (e.g., /about/, leave blank for root /).").addText(i=>i.setPlaceholder("/").setValue(s.pagesLinkBasePath).onChange(async t=>{s.pagesLinkBasePath=t,await this.plugin.saveSettings()})),new b.Setting(this.pagesFieldsContainer).setName("Creation mode").setDesc("How to create new entries: file-based or folder-based with an index file.").addDropdown(i=>i.addOption("file","File-based (page-title.md)").addOption("folder","Folder-based (page-title/index.md)").setValue(s.pagesCreationMode||"file").onChange(async t=>{s.pagesCreationMode=t,await this.plugin.saveSettings(),this.updatePagesIndexFileField()})),this.pagesIndexFileContainer=this.pagesFieldsContainer.createDiv({cls:"pages-index-file-field"}),this.pagesIndexFileContainer.classList.toggle("astro-composer-setting-container-visible",(s.pagesCreationMode||"file")==="folder"),this.pagesIndexFileContainer.classList.toggle("astro-composer-setting-container-hidden",(s.pagesCreationMode||"file")!=="folder"),new b.Setting(this.pagesIndexFileContainer).setName("Index file name").setDesc("Name for index files in folder-based content (without .md extension). Defaults to 'index' if left blank.").addText(i=>i.setPlaceholder("index").setValue(s.pagesIndexFileName||"").onChange(async t=>{s.pagesIndexFileName=t,await this.plugin.saveSettings()})),new b.Setting(this.pagesFieldsContainer).setName("Page properties template").setDesc("Template for new page files. Variables include {{title}} and {{date}}.").addTextArea(i=>(i.setPlaceholder(`---
title: "{{title}}"
description: ""
---
`).setValue(s.pageTemplate).onChange(async t=>{s.pageTemplate=t,await this.plugin.saveSettings()}),i.inputEl.classList.add("astro-composer-template-textarea"),i)),new b.Setting(e).setName("Custom content types").setDesc("").setHeading(),this.customContentTypesContainer=e.createDiv({cls:"custom-content-types-container"}),this.renderCustomContentTypes(),this.updateConditionalFields(),this.updateIndexFileField(),this.updateExcludedDirsField(),this.updateOnlyAutomateField(),this.updatePagesFields(),this.updateCopyHeadingFields()}updateConditionalFields(){if(this.autoRenameContainer){let e=this.plugin.settings;this.autoRenameContainer.classList.toggle("astro-composer-setting-container-visible",e.automatePostCreation),this.autoRenameContainer.classList.toggle("astro-composer-setting-container-hidden",!e.automatePostCreation)}}updateIndexFileField(){if(this.indexFileContainer){let e=this.plugin.settings;this.indexFileContainer.classList.toggle("astro-composer-setting-container-visible",e.creationMode==="folder"),this.indexFileContainer.classList.toggle("astro-composer-setting-container-hidden",e.creationMode!=="folder")}}updateOnlyAutomateField(){if(this.onlyAutomateContainer){let e=this.plugin.settings;this.onlyAutomateContainer.classList.toggle("astro-composer-setting-container-visible",!!e.postsFolder),this.onlyAutomateContainer.classList.toggle("astro-composer-setting-container-hidden",!e.postsFolder)}}updateExcludedDirsField(){if(this.excludedDirsContainer){let e=this.plugin.settings;this.excludedDirsContainer.classList.toggle("astro-composer-setting-container-visible",!!e.postsFolder&&!e.onlyAutomateInPostsFolder),this.excludedDirsContainer.classList.toggle("astro-composer-setting-container-hidden",!(e.postsFolder&&!e.onlyAutomateInPostsFolder))}}updatePagesFields(){if(this.pagesFieldsContainer){let e=this.plugin.settings;this.pagesFieldsContainer.classList.toggle("astro-composer-setting-container-visible",e.enablePages),this.pagesFieldsContainer.classList.toggle("astro-composer-setting-container-hidden",!e.enablePages)}}updateCopyHeadingFields(){if(this.copyHeadingContainer){let e=this.plugin.settings;this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-visible",e.enableCopyHeadingLink),this.copyHeadingContainer.classList.toggle("astro-composer-setting-container-hidden",!e.enableCopyHeadingLink)}}checkForFolderConflicts(){let e=this.plugin.settings,s=[],i={};!e.postsFolder&&e.automatePostCreation?s.push("Posts"):e.postsFolder&&e.automatePostCreation&&(i[e.postsFolder]||(i[e.postsFolder]=[]),i[e.postsFolder].push("Posts")),!e.pagesFolder&&e.enablePages?s.push("Pages"):e.pagesFolder&&e.enablePages&&(i[e.pagesFolder]||(i[e.pagesFolder]=[]),i[e.pagesFolder].push("Pages"));for(let a of e.customContentTypes)a.enabled&&(a.folder?(i[a.folder]||(i[a.folder]=[]),i[a.folder].push(a.name||"Custom Content")):s.push(a.name||"Custom Content"));let t=!1,o="";s.length>1&&(t=!0,o+=`Multiple content types are set to use the vault root: <strong>${s.join(", ")}</strong><br><br>`);for(let[a,r]of Object.entries(i))r.length>1&&(t=!0,o+=`Multiple content types are set to use the same folder "${a}": <strong>${r.join(", ")}</strong><br><br>`)}addCustomContentType(){let e=this.plugin.settings,s={id:`custom-${Date.now()}`,name:`Custom ${e.customContentTypes.length+1}`,folder:"",linkBasePath:"",template:`---
title: "{{title}}"
date: {{date}}
---
`,enabled:!0,creationMode:"file",indexFileName:""};e.customContentTypes.push(s),this.plugin.saveSettings(),this.renderCustomContentTypes(),this.plugin.registerCreateEvent()}renderCustomContentTypes(){if(!this.customContentTypesContainer)return;this.customContentTypesContainer.empty(),this.plugin.settings.customContentTypes.forEach((t,o)=>{if(!this.customContentTypesContainer)return;let a=this.customContentTypesContainer.createDiv({cls:"custom-content-type-item",attr:{"data-type-id":t.id}}),r=a.createDiv({cls:"custom-content-type-header"});r.classList.add("astro-composer-custom-type-header"),r.createDiv().createEl("div",{text:`Custom ${o+1}`,cls:"setting-item-name"});let c=r.createDiv({cls:"checkbox-container"});t.enabled&&c.classList.add("is-enabled");let d=c.createEl("input",{type:"checkbox",cls:"checkbox-input"});d.checked=t.enabled,c.addEventListener("click",async u=>{u.preventDefault();let F=!t.enabled;t.enabled=F,d.checked=F,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),F?c.classList.add("is-enabled"):c.classList.remove("is-enabled"),this.updateCustomContentTypeVisibility(t.id,F)}),d.addEventListener("change",async u=>{let F=u.target.checked;t.enabled=F,await this.plugin.saveSettings(),this.plugin.registerCreateEvent(),F?c.classList.add("is-enabled"):c.classList.remove("is-enabled"),this.updateCustomContentTypeVisibility(t.id,F)});let p=a.createDiv({cls:"custom-content-type-settings",attr:{"data-type-id":t.id}}),m=p.createDiv();new b.Setting(m).setName("Content type name").setDesc("Display name for this content type (e.g., 'Projects', 'Notes', 'Tutorials')").addText(u=>{u.setPlaceholder("Enter content type name").setValue(t.name).onChange(async F=>{t.name=F,await this.plugin.saveSettings()})});let h=p.createDiv();new b.Setting(h).setName("Folder location").setDesc("Folder path where this content type will be created (e.g., 'projects', 'notes/tutorials')").addText(u=>{u.setPlaceholder("Enter folder path").setValue(t.folder).onChange(async F=>{t.folder=F,await this.plugin.saveSettings(),this.plugin.registerCreateEvent()})});let C=p.createDiv();new b.Setting(C).setName("Link base path").setDesc("Base path for converted links (e.g., '/projects/', '/notes/tutorials/', leave blank for root /).").addText(u=>{u.setPlaceholder("Enter link base path").setValue(t.linkBasePath||"").onChange(async F=>{t.linkBasePath=F,await this.plugin.saveSettings()})});let g=p.createDiv();new b.Setting(g).setName("Creation mode").setDesc("How to create new entries: file-based or folder-based with an index file.").addDropdown(u=>u.addOption("file","File-based (content-title.md)").addOption("folder","Folder-based (content-title/index.md)").setValue(t.creationMode).onChange(async F=>{t.creationMode=F,await this.plugin.saveSettings(),this.updateCustomContentTypeIndexFileField(t.id)}));let y=p.createDiv({cls:"custom-index-file-field"});y.classList.toggle("astro-composer-setting-container-visible",t.creationMode==="folder"),y.classList.toggle("astro-composer-setting-container-hidden",t.creationMode!=="folder"),new b.Setting(y).setName("Index file name").setDesc("Name for index files in folder-based content (without .md extension). Defaults to 'index' if left blank.").addText(u=>u.setPlaceholder("index").setValue(t.indexFileName).onChange(async F=>{t.indexFileName=F,await this.plugin.saveSettings()}));let P=p.createDiv();new b.Setting(P).setName("Properties template").addTextArea(u=>(u.setPlaceholder(`---
title: "{{title}}"
date: {{date}}
---
`).setValue(t.template).onChange(async F=>{t.template=F,await this.plugin.saveSettings()}),u.inputEl.classList.add("astro-composer-template-textarea"),u)).then(u=>{u.descEl.empty();let F=u.descEl.createEl("div");F.createEl("div",{text:"Template for new files of this content type."}),F.createEl("div",{text:"Variables include {{title}} and {{date}}."}),F.createEl("div",{text:"Do not wrap {{date}} in quotes as it represents a datetime value, not a string."})});let x=p.createDiv();new b.Setting(x).setName("").addButton(u=>{u.setButtonText("Remove").setWarning().onClick(()=>{this.removeCustomContentType(t.id)})}).settingEl.classList.add("astro-composer-remove-setting"),this.updateCustomContentTypeVisibility(t.id,t.enabled)});let s=this.customContentTypesContainer.createDiv();new b.Setting(s).setName("").addButton(t=>{t.setButtonText("Add custom content type").setCta().onClick(()=>{this.addCustomContentType()})}).settingEl.classList.add("astro-composer-add-button")}updateCustomContentTypeVisibility(e,s){var t;let i=(t=this.customContentTypesContainer)==null?void 0:t.querySelector(`[data-type-id="${e}"].custom-content-type-settings`);i&&(i.classList.toggle("astro-composer-setting-container-visible",s),i.classList.toggle("astro-composer-setting-container-hidden",!s))}updateCustomContentTypeIndexFileField(e){var t;let s=this.plugin.settings.customContentTypes.find(o=>o.id===e);if(!s)return;let i=(t=this.customContentTypesContainer)==null?void 0:t.querySelector(`[data-type-id="${e}"] .custom-index-file-field`);i&&(i.classList.toggle("astro-composer-setting-container-visible",s.creationMode==="folder"),i.classList.toggle("astro-composer-setting-container-hidden",s.creationMode!=="folder"))}updatePagesIndexFileField(){this.pagesIndexFileContainer&&(this.pagesIndexFileContainer.classList.toggle("astro-composer-setting-container-visible",this.plugin.settings.pagesCreationMode==="folder"),this.pagesIndexFileContainer.classList.toggle("astro-composer-setting-container-hidden",this.plugin.settings.pagesCreationMode!=="folder"))}removeCustomContentType(e){let s=this.plugin.settings;s.customContentTypes=s.customContentTypes.filter(i=>i.id!==e),this.plugin.saveSettings(),this.renderCustomContentTypes(),this.plugin.registerCreateEvent()}};var O=class{constructor(n){this.settings=n}toKebabCase(n){return n.toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}getAstroUrlFromInternalLink(n){let e=n.indexOf("#"),s=e>=0?n.slice(0,e):n,i=e>=0?n.slice(e):"";s=s.replace(/\.md$/,"");let t="",o="",a="file",r="",l=!1;for(let h of this.settings.customContentTypes)if(h.enabled&&h.folder&&s.startsWith(h.folder+"/")){o=h.folder,t=h.linkBasePath||"",a=h.creationMode,r=h.indexFileName,l=!0;break}!l&&this.settings.enablePages&&this.settings.pagesFolder&&s.startsWith(this.settings.pagesFolder+"/")?(o=this.settings.pagesFolder,t=this.settings.pagesLinkBasePath,a=this.settings.pagesCreationMode||"file",r=this.settings.pagesIndexFileName||""):!l&&this.settings.postsFolder&&s.startsWith(this.settings.postsFolder+"/")?(o=this.settings.postsFolder,t=this.settings.postsLinkBasePath,a=this.settings.creationMode,r=this.settings.indexFileName||"index"):!l&&!this.settings.postsFolder&&this.settings.automatePostCreation&&!this.settings.onlyAutomateInPostsFolder&&(t=this.settings.postsLinkBasePath,a=this.settings.creationMode,r=this.settings.indexFileName||"index"),o&&(s=s.slice(o.length+1));let c=!1;if(r&&r.trim()!==""){let h=s.split("/");h[h.length-1]===r&&(h.pop(),s=h.join("/"),c=!0)}else if(a==="folder"){let h="index",C=s.split("/");C[C.length-1]===h&&(C.pop(),s=C.join("/"),c=!0)}let p=s.split("/").map(h=>this.toKebabCase(h)).join("/");t&&(t.startsWith("/")||(t="/"+t),t.endsWith("/")||(t+="/"));let m=this.settings.addTrailingSlashToLinks||c;return`${t}${p}${m?"/":""}${i}`}generateObsidianLink(n,e,s){let i=s.heading;if(n.fileManager.generateMarkdownLink(e,"","").startsWith("[["))return`[[${e.path.replace(/\.md$/,"")}#${i}|${i}]]`;{let o=this.toKebabCase(i),a=n.fileManager.generateMarkdownLink(e,"","");if(a.startsWith("[["))return`[[${e.path.replace(/\.md$/,"")}#${i}|${i}]]`;{let r=a.match(/\[([^\]]+)\]\(([^)]+)\)/);if(r){let[,,l]=r;return`[${i}](${l}#${encodeURIComponent(o)})`}else{let l=encodeURIComponent(e.name);return`[${i}](${l}#${encodeURIComponent(o)})`}}}}generateObsidianWikilink(n,e){let s=e.heading;return`[[${n.path.replace(/\.md$/,"")}#${s}|${s}]]`}generateAstroLink(n,e){let s=e.heading,i=this.toKebabCase(s),t=`${n.path}#${i}`,o=this.getAstroUrlFromInternalLink(t);return`[${s}](${o})`}generateAstroWikilink(n,e){let s=e.heading,i=this.toKebabCase(s),t=`${n.path}#${i}`,o=this.getAstroUrlFromInternalLink(t);return`[[${s}|${o}]]`}generateLink(n,e,s){return this.settings.copyHeadingLinkFormat==="astro"?this.generateAstroLink(e,s):this.generateObsidianLink(n,e,s)}findHeadingAtLine(n,e,s){let i=n.metadataCache.getFileCache(e);if(!i||!i.headings)return null;for(let t=i.headings.length-1;t>=0;t--){let o=i.headings[t];if(o.position.start.line<=s)return o}return null}};var W=class extends A.Plugin{constructor(){super(...arguments);this.pluginCreatedFiles=new Set}async onload(){await this.loadSettings(),this.fileOps=new v(this.app,this.settings,this),this.templateParser=new $(this.app,this.settings),this.headingLinkGenerator=new O(this.settings),this.app.workspace.onLayoutReady(()=>{this.registerCreateEvent()}),V(this,this.settings),this.addSettingTab(new I(this.app,this)),this.registerContextMenu()}registerCreateEvent(){let e=this.settings.customContentTypes.some(i=>i.enabled);if(this.settings.automatePostCreation||this.settings.enablePages||e){let i=0;this.createEvent=async t=>{var a;let o=Date.now();if(!(o-i<M.DEBOUNCE_MS)&&(i=o,t instanceof A.TFile&&t.extension==="md")){let r=t.path;if(this.pluginCreatedFiles.has(r)){this.pluginCreatedFiles.delete(r);return}let l=this.settings.postsFolder||"",c=this.settings.enablePages&&this.settings.pagesFolder||"",d=!1,p=null,m=!1,h=!1;if(l&&this.settings.excludedDirectories){let u=this.settings.excludedDirectories.split("|").map(F=>F.trim()).filter(F=>F);for(let F of u)if(r===F||r.startsWith(F+"/")){h=!0;break}}if(h)return;let C=((a=t.parent)==null?void 0:a.path)||"",g=C===""||C==="/",y=[];this.settings.automatePostCreation&&(!l&&g||l&&(r.startsWith(l+"/")||r===l))&&y.push("Posts"),this.settings.enablePages&&(!c&&g||c&&(r.startsWith(c+"/")||r===c))&&y.push("Pages");for(let u of this.settings.customContentTypes)u.enabled&&(!u.folder&&g||u.folder&&(r.startsWith(u.folder+"/")||r===u.folder))&&y.push(u.name||"Custom Content");if(y.length>1){new A.Notice(`\u26A0\uFE0F Folder conflict detected! Multiple content types (${y.join(", ")}) would process this file. Please specify different folders in settings.`);return}for(let u of this.settings.customContentTypes)if(u.enabled){if(u.folder&&(r.startsWith(u.folder+"/")||r===u.folder)){p=u.id,m=!0;break}else if(!u.folder){p=u.id,m=!0;break}}if(p||(c&&(r.startsWith(c+"/")||r===c)||!c&&this.settings.enablePages&&g)&&(d=!0,m=!0),!m&&this.settings.automatePostCreation)if(l)if(this.settings.onlyAutomateInPostsFolder){let u=r.split("/").length,F=l.split("/").length;(r.startsWith(l+"/")||r===l)&&u<=F+1&&(m=!0)}else(r.startsWith(l+"/")||r===l)&&(m=!0);else m=!0;if(!m)return;let P=await this.app.vault.adapter.stat(t.path);if(!((P==null?void 0:P.mtime)&&o-P.mtime<M.STAT_MTIME_THRESHOLD))return;let w=this.app.metadataCache.getFileCache(t);if(w!=null&&w.frontmatter){let u=Object.keys(w.frontmatter);if(u.length>1||!u.includes("title"))return}p?new L(this.app,t,this,p).open():d?new L(this.app,t,this,"page").open():new L(this.app,t,this,"post").open()}},this.registerEvent(this.app.vault.on("create",t=>{t instanceof A.TFile&&this.createEvent(t)}))}}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}registerContextMenu(){this.registerEvent(this.app.workspace.on("editor-menu",(e,s,i)=>{if(!this.settings.enableCopyHeadingLink)return;let t=s.getCursor(),o=i.file;if(!(o instanceof A.TFile))return;let a=this.headingLinkGenerator.findHeadingAtLine(this.app,o,t.line);a&&e.addItem(r=>{r.setTitle("Copy Heading Link").setIcon("link-2").onClick(async()=>{let l=this.headingLinkGenerator.generateLink(this.app,o,a);await navigator.clipboard.writeText(l),new A.Notice("Heading link copied to clipboard")})})}))}};
